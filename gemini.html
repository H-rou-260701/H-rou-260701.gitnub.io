<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-Pop Wonderland - å¶åƒæ”¶è—é¤¨ (å–®ä¸€æª”æ¡ˆç‰ˆ)</title>
    
    <style>
        /* K-Pop Wonderland åŸºç¤æ¨£å¼ */
        body {
            font-family: 'Arial Black', sans-serif; /* ç²—é«”å­—é«”å¢åŠ åŠ›é‡æ„Ÿ */
            background-color: #0d0d1a; /* æ·±å¤œè—/é»‘åº•è‰² */
            color: #e6e6ff; /* äº®ç™½è‰²/æ·ºç´«è‰²å­—é«” */
            margin: 0;
            padding: 0;
            line-height: 1.6;
            scroll-behavior: smooth;
        }

        /* éœ“è™¹æ¨™é¡Œæ•ˆæœ */
        h2 {
            text-align: center;
            color: #ff007f; /* éœ“è™¹ç²‰ */
            text-shadow: 0 0 5px #ff007f, 0 0 10px #ff007f, 0 0 20px #ff99e6;
            margin: 40px 0 20px;
            letter-spacing: 2px;
        }

        /* å°èˆªåˆ— */
        #main-nav {
            background-color: #1a0d33; /* æ·±ç´«èƒŒæ™¯ */
            padding: 15px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 3px solid #00ffff; /* äº®é’è‰²é‚Šæ¡† */
        }

        .logo {
            font-size: 2em;
            font-weight: bold;
            color: #00ffff; /* äº®é’è‰² */
            text-shadow: 0 0 3px #00ffff, 0 0 6px #00ffff;
        }

        #search-bar {
            padding: 8px 15px;
            border-radius: 20px;
            border: 2px solid #ff007f;
            background-color: #2a1a44;
            color: #fff;
            flex-grow: 0.3;
            margin: 0 20px;
        }

        #main-nav nav {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        #main-nav a {
            color: #e6e6ff;
            text-decoration: none;
            margin-left: 15px;
            padding: 5px 10px;
            transition: all 0.3s;
            border-radius: 5px;
            font-size: 0.9em;
        }

        #main-nav a:hover {
            background-color: #ff007f; /* éœ“è™¹ç²‰ */
            color: #0d0d1a;
            box-shadow: 0 0 8px #ff007f;
        }

        /* å…§å®¹å€å¡Š */
        .content-block {
            padding: 40px 5%;
            min-height: 50vh;
        }

        /* ç¶²æ ¼ä½ˆå±€ (Idols/Actors) */
        .kpop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 30px;
        }

        /* å¶åƒ/æ¼”å“¡å¡ç‰‡ */
        .idol-card {
            background: #1a1a2e;
            border: 1px solid #333;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .idol-card:hover {
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 10px 20px rgba(0, 255, 255, 0.4);
        }

        .idol-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 10px;
            filter: brightness(0.9);
        }

        .idol-card .name-kr, .idol-card .name-en {
            font-size: 0.85em;
            color: #aaa;
        }

        /* æ”¶è—æŒ‰éˆ• */
        .favorite-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #fff;
            font-size: 1.5em;
            cursor: pointer;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            line-height: 30px;
            padding: 0;
            transition: color 0.3s;
        }

        .favorite-btn.favorited {
            color: #ff007f;
            text-shadow: 0 0 5px #ff007f;
        }

        /* æ‹ç«‹å¾—å€æ¨£å¼ */
        #polaroid-zone { text-align: center; }
        #webcam-preview, #photo-canvas {
            width: 90%;
            max-width: 600px;
            border: 5px solid #ff007f;
            margin: 20px auto;
            display: block;
        }
        #polaroid-editor {
            position: relative;
            max-width: 600px;
            margin: 0 auto;
        }
        .sticker-icon {
            width: 50px;
            height: 50px;
            margin: 5px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border 0.2s;
        }
        .sticker-icon:hover {
            border: 2px solid #00ffff;
        }

        /* æ‡‰æ´ç‰†/ç•™è¨€å€æ¨£å¼ */
        #cheering-wall textarea, #comments-area textarea {
            width: 80%;
            min-height: 100px;
            padding: 15px;
            margin: 20px auto;
            display: block;
            background: #1a1a2e;
            color: #e6e6ff;
            border: 2px solid #00ffff;
            border-radius: 10px;
            font-size: 1em;
            resize: vertical;
        }
        #cheering-wall button, #comments-area button, #start-camera, #take-photo, .download-btn {
            padding: 10px 30px;
            background-color: #ff007f;
            color: white;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            margin: 10px;
            text-decoration: none; /* é‡å°ä¸‹è¼‰æŒ‰éˆ• */
            display: inline-block;
        }
        #cheering-wall button:hover, #comments-area button:hover, #start-camera:hover, #take-photo:hover, .download-btn:hover {
            background-color: #e60073;
            transform: scale(1.05);
        }
        #cheers-display, #comments-display {
            padding: 20px;
            max-width: 800px;
            margin: 20px auto;
            border: 1px dashed #aaa;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
        }
        .cheer-message, .comment-message {
            border-bottom: 1px solid #333;
            padding: 10px 0;
            font-style: italic;
        }
        .cheer-message:last-child, .comment-message:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>

    <audio id="kpop-bgm" controls loop hidden></audio>
    
    <header id="main-nav">
        <div class="logo">K-POP FANTASY</div>
        <input type="text" id="search-bar" placeholder="ğŸ” æœå°‹å¶åƒã€æ¼”å“¡...">
        <nav>
            <a href="#idols-section">ğŸ’– Idols (å¶åƒ)</a>
            <a href="#actress-section">ğŸ¬ Actress (å¥³æ¼”å“¡)</a>
            <a href="#actor-section">ğŸ­ Actor (ç”·æ¼”å“¡)</a>
            <a href="#polaroid-zone">ğŸ“¸ æ‹ç«‹å¾—å°ˆå€</a>
            <a href="#cheering-wall">ğŸ“£ æ‡‰æ´ç‰†</a>
            <a href="#comments-area">ğŸ’¬ ç•™è¨€å€</a>
        </nav>
    </header>

    <main>
        <section id="idols-section" class="content-block">
            <h2>â­ Idols (å¶åƒåå–®)</h2>
            <div id="idols-grid" class="kpop-grid">
                </div>
        </section>

        <section id="actress-section" class="content-block">
            <h2>ğŸ¬ Actress (å¥³æ¼”å“¡)</h2>
            <div id="actress-grid" class="kpop-grid">
                </div>
        </section>
        
        <section id="actor-section" class="content-block">
            <h2>ğŸ­ Actor (ç”·æ¼”å“¡)</h2>
            <div id="actor-grid" class="kpop-grid">
                </div>
        </section>

        <section id="polaroid-zone" class="content-block">
            <h2>ğŸ“¸ æ‹ç«‹å¾—å°ˆå€ - å‰µé€ ä½ çš„ç¨å®¶å‘¨é‚Š</h2>
            <div class="polaroid-tool-area">
                <button id="start-camera">é»æ“Šé€²å…¥æ‹ç…§æ¨¡å¼</button>
                <div id="polaroid-editor" style="display: none;">
                    <video id="webcam-preview" autoplay></video>
                    <canvas id="photo-canvas" style="display:none; cursor: crosshair;"></canvas>
                    <button id="take-photo" style="display:none;">ğŸ“· æ‹ç…§</button>
                    
                    <div id="sticker-selection">
                        </div>
                </div>
                <div id="download-area"></div>
                <div class="print-guide">
                    <h3>ğŸ“„ è¶…å•†åˆ—å°æŒ‡å—</h3>
                    <p>å®Œæˆä½œå“å¾Œï¼Œé»æ“Šä¸‹è¼‰åœ–ç‰‡ï¼Œå¯è‡³ **7-11 ibon / å…¨å®¶ FamiPort** é¸æ“‡ã€Œåœ–ç‰‡åˆ—å°ã€æœå‹™ï¼Œå°‡æª”æ¡ˆä¸Šå‚³è‡³é›²ç«¯æˆ–éš¨èº«ç¢Ÿå³å¯åˆ—å°ã€‚</p>
                </div>
            </div>
        </section>

        <section id="cheering-wall" class="content-block">
            <h2>ğŸ“£ æ‡‰æ´ç‰† - ç•™ä¸‹ä½ çš„è¨Šæ¯</h2>
            <textarea id="cheer-input" placeholder="åœ¨é€™è£¡ç•™ä¸‹ä½ å°å¶åƒçš„æ‡‰æ´è¨Šæ¯..."></textarea>
            <button onclick="postCheer()">é€å‡ºæ‡‰æ´</button>
            <div id="cheers-display">
                </div>
        </section>

        <section id="comments-area" class="content-block">
            <h2>ğŸ’¬ ç•™è¨€å€ - äº¤æµè¨è«–</h2>
            <textarea id="comment-input" placeholder="åœ¨é€™è£¡ç•™ä¸‹ä½ çš„è¨è«–..."></textarea>
            <button onclick="postComment()">é€å‡ºç•™è¨€</button>
            <div id="comments-display">
                </div>
        </section>
    </main>
    
    <script>
        // === A. æ•¸æ“šå®šç¾©ï¼šå¶åƒèˆ‡æ¼”å“¡ (50+äºº) ===
        const allStars = [
            // === ä½ æŒ‡å®šçš„å¶åƒ (Stray Kids & G-IDLE & BABYMONSTER & å…¶ä»–) ===
            { type: 'idol', name_cn: 'é‡‘æ˜‡çŸ', name_kr: 'ê¹€ìŠ¹ë¯¼', name_en: 'Kim Seungmin', group: 'Stray Kids', image: 'sm.jpg' },
            { type: 'idol', name_cn: 'éŸ“çŸ¥åŸ', name_kr: 'í•œì§€ì„±', name_en: 'Han Jisung', group: 'Stray Kids', image: 'han.jpg' },
            { type: 'idol', name_cn: 'ææ—»æµ©', name_kr: 'ì´ë¯¼í˜¸', name_en: 'Lee Minho (Lee Know)', group: 'Stray Kids', image: 'minho.jpg' },
            { type: 'idol', name_cn: 'å¾å½°å½¬', name_kr: 'ì„œì°½ë¹ˆ', name_en: 'Seo Changbin', group: 'Stray Kids', image: 'cb.jpg' },
            { type: 'idol', name_cn: 'æ¢ç²¾å¯…', name_kr: 'ì–‘ì •ì¸', name_en: 'Yang Jeongin (I.N)', group: 'Stray Kids', image: 'in.jpg' },
            { type: 'idol', name_cn: 'è‘‰èˆ’è¯', name_kr: 'ì˜ˆìŠˆí™”', name_en: 'Yeh Shuhua', group: '(G)I-DLE', image: 'shuhua.jpg' },
            { type: 'idol', name_cn: 'Ruka', name_kr: 'ë£¨ì¹´', name_en: 'Ruka', group: 'BABYMONSTER', image: 'ruka.jpg' },
            { type: 'idol', name_cn: 'Pharita', name_kr: 'íŒŒë¦¬íƒ€', name_en: 'Pharita', group: 'BABYMONSTER', image: 'pharita.jpg' },
            { type: 'idol', name_cn: 'Asa', name_kr: 'ì•„ì‚¬', name_en: 'Asa', group: 'BABYMONSTER', image: 'asa.jpg' },
            { type: 'idol', name_cn: 'Ahyeon', name_kr: 'ì•„í˜„', name_en: 'Ahyeon', group: 'BABYMONSTER', image: 'ahyeon.jpg' },
            { type: 'idol', name_cn: 'Rami', name_kr: 'ë¼ë¯¸', name_en: 'Rami', group: 'BABYMONSTER', image: 'rami.jpg' },
            { type: 'idol', name_cn: 'Rora', name_kr: 'ë¡œë¼', name_en: 'Rora', group: 'BABYMONSTER', image: 'rora.jpg' },
            { type: 'idol', name_cn: 'Chiquita', name_kr: 'ì¹˜í‚¤íƒ€', name_en: 'Chiquita', group: 'BABYMONSTER', image: 'chiquita.jpg' },
            
            // === ä½ æŒ‡å®šçš„æ¼”å“¡/ç·´ç¿’ç”Ÿ/æ¨¡ç‰¹ (çµ±ä¸€æ­¸é¡ actor/actress) ===
            { type: 'actor', name_cn: 'Bailey', name_kr: 'ë² ì¼ë¦¬', name_en: 'Bailey', group: 'Model', image: 'bailey.jpg' },
            { type: 'actor', name_cn: 'Woochan', name_kr: 'ìš°ì°¬', name_en: 'Woochan', group: 'Trainee', image: 'woochan.jpg' },
            { type: 'actor', name_cn: 'Youngseo', name_kr: 'ì˜ì„œ', name_en: 'Youngseo', group: 'Trainee', image: 'youngseo.jpg' },
            { type: 'actor', name_cn: 'Tarzzan', name_kr: 'íƒ€ì”', name_en: 'Tarzzan', group: 'Model', image: 'tarzzan.jpg' },
            { type: 'actress', name_cn: 'Annie', name_kr: 'ì• ë‹ˆ', name_en: 'Annie', group: 'Model', image: 'annie.jpg' },
            { type: 'actress', name_cn: 'å…‹ç¾…ä¼Šæ', name_kr: 'í´ë¡œì´ ë¦¬', name_en: 'Chloe Lee', group: 'Model', image: 'chloe.jpg' },
            { type: 'actress', name_cn: 'ç”°ä¸­æå¥ˆ', name_kr: 'ë‹¤ë‚˜ì¹´ ì•ˆë‚˜', name_en: 'Tanaka Anna', group: 'Model', image: 'anna.jpg' },
            { type: 'actress', name_cn: 'åŸƒæ‹‰æ ¼ç¾…æ–¯', name_kr: 'ì—˜ë¼ ê·¸ë¡œìŠ¤', name_en: 'Ella Gross', group: 'Model', image: 'ella.jpg' },
            { type: 'actress', name_cn: 'Sooin', name_kr: 'ìˆ˜ì¸', name_en: 'Sooin', group: 'Model', image: 'sooin.jpg' },
            { type: 'actress', name_cn: 'Narin', name_kr: 'ë‚˜ë¦°', name_en: 'Narin', group: 'Model', image: 'narin.jpg' },

            // === è£œå……å…¶ä»–å¶åƒ (ç¢ºä¿ç¸½æ•¸å¤§æ–¼50) ===
            { type: 'idol', name_cn: 'é‡‘æ³°äº¨', name_kr: 'ê¹€íƒœí˜•', name_en: 'V', group: 'BTS', image: 'v.jpg' },
            { type: 'idol', name_cn: 'ç”°æŸ¾åœ‹', name_kr: 'ì „ì •êµ­', name_en: 'Jungkook', group: 'BTS', image: 'jk.jpg' },
            { type: 'idol', name_cn: 'Jennie', name_kr: 'ì œë‹ˆ', name_en: 'Jennie', group: 'BLACKPINK', image: 'jennie.jpg' },
            { type: 'idol', name_cn: 'Lisa', name_kr: 'ë¦¬ì‚¬', name_en: 'Lisa', group: 'BLACKPINK', image: 'lisa.jpg' },
            { type: 'idol', name_cn: 'é‡‘æ™ºç§€', name_kr: 'ê¹€ì§€ìˆ˜', name_en: 'Jisoo', group: 'BLACKPINK', image: 'jisoo.jpg' },
            { type: 'idol', name_cn: 'æœ´å½©è‹±', name_kr: 'ë°•ì±„ì˜', name_en: 'RosÃ©', group: 'BLACKPINK', image: 'rose.jpg' },
            { type: 'idol', name_cn: 'æœ´æ™ºæ—»', name_kr: 'ë°•ì§€ë¯¼', name_en: 'Jimin', group: 'BTS', image: 'jimin.jpg' },
            { type: 'idol', name_cn: 'é„­è™ŸéŒ«', name_kr: 'ì •í˜¸ì„', name_en: 'J-Hope', group: 'BTS', image: 'jhope.jpg' },
            { type: 'idol', name_cn: 'é‡‘ç¢©ç', name_kr: 'ê¹€ì„ì§„', name_en: 'Jin', group: 'BTS', image: 'jin.jpg' },
            { type: 'idol', name_cn: 'é–”ç§å…¶', name_kr: 'ë¯¼ìœ¤ê¸°', name_en: 'Suga', group: 'BTS', image: 'suga.jpg' },
            { type: 'idol', name_cn: 'é‡‘å—ä¿Š', name_kr: 'ê¹€ë‚¨ì¤€', name_en: 'RM', group: 'BTS', image: 'rm.jpg' },
            { type: 'idol', name_cn: 'Irene', name_kr: 'ì•„ì´ë¦°', name_en: 'Irene', group: 'Red Velvet', image: 'irene.jpg' },
            { type: 'idol', name_cn: 'å§œæ¾€çª', name_kr: 'ê°•ìŠ¬ê¸°', name_en: 'Seulgi', group: 'Red Velvet', image: 'seulgi.jpg' },
            { type: 'idol', name_cn: 'æ–‡æ˜Ÿä¼Š', name_kr: 'ë¬¸ë³„ì´', name_en: 'Moonbyul', group: 'MAMAMOO', image: 'moonbyul.jpg' },
            { type: 'idol', name_cn: 'è¯è', name_kr: 'í™”ì‚¬', name_en: 'Hwasa', group: 'MAMAMOO', image: 'hwasa.jpg' },
            { type: 'idol', name_cn: 'å´”ç§€å½¬', name_kr: 'ìµœìˆ˜ë¹ˆ', name_en: 'Soobin', group: 'TXT', image: 'soobin.jpg' },
            { type: 'idol', name_cn: 'å´”ç„¶ç«£', name_kr: 'ìµœì—°ì¤€', name_en: 'Yeonjun', group: 'TXT', image: 'yeonjun.jpg' },
            { type: 'idol', name_cn: 'æçŸ¥æ©', name_kr: 'ì´ì§€ì€', name_en: 'IU', group: 'Solo', image: 'iu.jpg' },
            { type: 'idol', name_cn: 'é‡‘æ³«é›…', name_kr: 'ê¹€í˜„ì•„', name_en: 'HyunA', group: 'Solo', image: 'hyuna.jpg' },
            { type: 'idol', name_cn: 'æ—å¨œç’‰', name_kr: 'ì„ë‚˜ì—°', name_en: 'Nayeon', group: 'TWICE', image: 'nayeon.jpg' },
            { type: 'idol', name_cn: 'æ¹Šå´ç´—å¤', name_kr: 'ì‚¬ë‚˜', name_en: 'Sana', group: 'TWICE', image: 'sana.jpg' },
            { type: 'idol', name_cn: 'å´”æœ‰çœŸ', name_kr: 'ìµœìœ ì§„', name_en: 'Yujin', group: 'IVE', image: 'yujin.jpg' },
            { type: 'idol', name_cn: 'å¼µå“¡ç‘›', name_kr: 'ì¥ì›ì˜', name_en: 'Wonyoung', group: 'IVE', image: 'wonyoung.jpg' },
            { type: 'idol', name_cn: 'é‡‘é‡‡æº', name_kr: 'ê¹€ì±„ì›', name_en: 'Chaewon', group: 'LE SSERAFIM', image: 'chaewon.jpg' },
            { type: 'idol', name_cn: 'è¨±å…çœŸ', name_kr: 'í—ˆìœ¤ì§„', name_en: 'Yunjin', group: 'LE SSERAFIM', image: 'yunjin.jpg' },
            { type: 'idol', name_cn: 'Minji', name_kr: 'ë¯¼ì§€', name_en: 'Minji', group: 'NewJeans', image: 'minji.jpg' },
            { type: 'idol', name_cn: 'Hanni', name_kr: 'í•˜ë‹ˆ', name_en: 'Hanni', group: 'NewJeans', image: 'hanni.jpg' },
            { type: 'idol', name_cn: 'æå¸åŠª', name_kr: 'ì´ì œë…¸', name_en: 'Jeno', group: 'NCT DREAM', image: 'jeno.jpg' },
            { type: 'idol', name_cn: 'ç¾…æ¸½æ°‘', name_kr: 'ë‚˜ì¬ë¯¼', name_en: 'Jaemin', group: 'NCT DREAM', image: 'jaemin.jpg' },
            
            // === è£œå……æ¼”å“¡ ===
            { type: 'actor', name_cn: 'ææ•é¬', name_kr: 'ì´ë¯¼í˜¸', name_en: 'Lee Min Ho', group: 'Actor', image: 'lmh.jpg' },
            { type: 'actress', name_cn: 'æœ´æ•è‹±', name_kr: 'ë°•ë¯¼ì˜', name_en: 'Park Min Young', group: 'Actress', image: 'pmy.jpg' },
            { type: 'actress', name_cn: 'å®‹æ…§å–¬', name_kr: 'ì†¡í˜œêµ', name_en: 'Song Hye Kyo', group: 'Actress', image: 'shk.jpg' },
            { type: 'actor', name_cn: 'ç„å½¬', name_kr: 'í˜„ë¹ˆ', name_en: 'Hyun Bin', group: 'Actor', image: 'hb.jpg' },
            { type: 'actress', name_cn: 'å…¨æ™ºè³¢', name_kr: 'ì „ì§€í˜„', name_en: 'Jun Ji Hyun', group: 'Actress', image: 'jjh.jpg' },
            { type: 'actor', name_cn: 'å­”åŠ‰', name_kr: 'ê³µìœ ', name_en: 'Gong Yoo', group: 'Actor', image: 'gy.jpg' },
            { type: 'actress', name_cn: 'éŸ“å­å‘¨', name_kr: 'í•œíš¨ì£¼', name_en: 'Han Hyo Joo', group: 'Actress', image: 'hhj.jpg' },
            { type: 'actor', name_cn: 'æœ´æ•˜ä¿Š', name_kr: 'ë°•ì„œì¤€', name_en: 'Park Seo Joon', group: 'Actor', image: 'psj.jpg' },
            { type: 'actress', name_cn: 'é‡‘é«˜éŠ€', name_kr: 'ê¹€ê³ ì€', name_en: 'Kim Go Eun', group: 'Actress', image: 'kge.jpg' },
            { type: 'actor', name_cn: 'ä¸æµ·å¯…', name_kr: 'ì •í•´ì¸', name_en: 'Jung Hae In', group: 'Actor', image: 'jhi.jpg' },
        ];
        
        // === B. éŸ³æ¨‚æ’­æ”¾åŠŸèƒ½ ===
        const bgm = document.getElementById('kpop-bgm');
        const kpopPlaylist = [
            'kpop/song1.mp3', // ç¢ºä¿æ­¤è·¯å¾‘æ­£ç¢º
            'kpop/song2.mp3',
            'kpop/song3.mp3'
        ];
        let currentSongIndex = 0;

        function playNextSong() {
            currentSongIndex = (currentSongIndex + 1) % kpopPlaylist.length;
            bgm.src = kpopPlaylist[currentSongIndex];
            bgm.play().catch(e => console.log('Autoplay failed:', e));
        }

        function initBGM() {
            bgm.src = kpopPlaylist[currentSongIndex];
            bgm.addEventListener('ended', playNextSong);

            // è™•ç†ç€è¦½å™¨è‡ªå‹•æ’­æ”¾é™åˆ¶
            document.body.addEventListener('click', () => {
                if (bgm.paused) {
                    bgm.play().catch(e => console.log('Play failed on click:', e));
                }
            }, { once: true });
        }

        // === C. å¶åƒ/æ¼”å“¡åˆ—è¡¨èˆ‡æ”¶è—åŠŸèƒ½ ===

        // å‡½æ•¸ï¼šå‰µå»ºè—äººå¡ç‰‡
        function createStarCard(star) {
            const isFavorited = localStorage.getItem(`star_${star.name_en}`) === 'true';
            const favoriteClass = isFavorited ? 'favorited' : '';
            const heartIcon = isFavorited ? 'â¤ï¸' : 'ğŸ¤';

            const card = document.createElement('div');
            card.className = 'idol-card';
            card.dataset.name = star.name_en;

            card.innerHTML = `
                <img src="images/${star.image}" alt="${star.name_en} å½¢è±¡ç…§" onerror="this.onerror=null;this.src='images/default.jpg';">
                <h3>${star.name_cn}</h3>
                <p class="name-kr">(${star.name_kr})</p>
                <p class="name-en">${star.name_en}</p>
                <p class="group">${star.group}</p>
                <button class="favorite-btn ${favoriteClass}" data-name="${star.name_en}">
                    ${heartIcon}
                </button>
            `;

            // ç¶å®šæ”¶è—äº‹ä»¶
            card.querySelector('.favorite-btn').addEventListener('click', toggleFavorite);
            return card;
        }

        // å‡½æ•¸ï¼šåˆ‡æ›æ”¶è—ç‹€æ…‹
        function toggleFavorite(event) {
            event.stopPropagation();
            const btn = event.currentTarget;
            const starName = btn.dataset.name;
            let isFavorited = btn.classList.contains('favorited');

            if (isFavorited) {
                btn.classList.remove('favorited');
                btn.innerHTML = 'ğŸ¤';
                localStorage.removeItem(`star_${starName}`);
            } else {
                btn.classList.add('favorited');
                btn.innerHTML = 'â¤ï¸';
                localStorage.setItem(`star_${starName}`, 'true');
            }
        }

        // å‡½æ•¸ï¼šåˆå§‹åŒ–é é¢ï¼Œç”Ÿæˆåˆ—è¡¨
        function initStars() {
            const idolsGrid = document.getElementById('idols-grid');
            const actressGrid = document.getElementById('actress-grid');
            const actorGrid = document.getElementById('actor-grid');

            allStars.forEach(star => {
                const card = createStarCard(star);
                if (star.type === 'idol') {
                    idolsGrid.appendChild(card);
                } else if (star.type === 'actress') {
                    actressGrid.appendChild(card);
                } else if (star.type === 'actor') {
                    actorGrid.appendChild(card);
                }
            });
        }

        // === D. æ‹ç«‹å¾—å°ˆå€åŠŸèƒ½ (ç›¸æ©Ÿèˆ‡è²¼ç´™æ‹–æ”¾) ===
        const startCameraBtn = document.getElementById('start-camera');
        const webcamPreview = document.getElementById('webcam-preview');
        const takePhotoBtn = document.getElementById('take-photo');
        const photoCanvas = document.getElementById('photo-canvas');
        const polaroidEditor = document.getElementById('polaroid-editor');
        const stickerSelection = document.getElementById('sticker-selection');
        const downloadArea = document.getElementById('download-area');
        const ctx = photoCanvas.getContext('2d');
        let stream = null;
        let stickersOnCanvas = []; 

        // è²¼ç´™æ•¸æ“š
        const stickers = [
            'stickers/heart.png', 'stickers/star.png', 'stickers/skz.png', 'stickers/bm.png', 'stickers/kpop_logo.png'
        ];

        // è¼‰å…¥è²¼ç´™åˆ°é¸å–®
        function loadStickers() {
            stickerSelection.innerHTML = '<h3>é¸æ“‡è²¼ç´™ (å¯æ‹–æ›³åˆ°ç…§ç‰‡ä¸Š):</h3>';
            stickers.forEach(src => {
                const img = document.createElement('img');
                img.src = src;
                img.className = 'sticker-icon';
                img.draggable = true;
                img.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', src);
                });
                stickerSelection.appendChild(img);
            });
        }

        // å•Ÿå‹•ç›¸æ©Ÿ
        startCameraBtn.addEventListener('click', async () => {
            startCameraBtn.style.display = 'none';
            polaroidEditor.style.display = 'block';
            downloadArea.innerHTML = '';
            stickersOnCanvas = [];

            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: { width: 640, height: 480 } }); // æŒ‡å®šè§£æåº¦
                webcamPreview.srcObject = stream;
                webcamPreview.style.display = 'block';
                photoCanvas.style.display = 'none';
                takePhotoBtn.style.display = 'block';
            } catch (err) {
                alert('ç„¡æ³•è¨ªå•ç›¸æ©Ÿï¼Œè«‹æª¢æŸ¥æ¬Šé™æˆ–ä½¿ç”¨æ”¯æ´ HTTPS çš„ç’°å¢ƒã€‚éŒ¯èª¤: ' + err);
                polaroidEditor.style.display = 'none';
                startCameraBtn.style.display = 'block';
            }
        });

        // æ‹ç…§åŠŸèƒ½
        takePhotoBtn.addEventListener('click', () => {
            if (!stream) return;

            // ç¢ºä¿ Canvas å°ºå¯¸èˆ‡è¦–è¨Šç•«é¢ç›¸åŒ
            photoCanvas.width = webcamPreview.videoWidth || 640;
            photoCanvas.height = webcamPreview.videoHeight || 480;
            
            // ç¹ªè£½ç…§ç‰‡
            ctx.drawImage(webcamPreview, 0, 0, photoCanvas.width, photoCanvas.height);
            
            // åœæ­¢è¦–è¨Šæµ
            stream.getTracks().forEach(track => track.stop());
            
            webcamPreview.style.display = 'none';
            photoCanvas.style.display = 'block';
            takePhotoBtn.style.display = 'none';

            createDownloadLink();

            alert('æ‹ç…§å®Œæˆï¼ç¾åœ¨å¯ä»¥åœ¨ç…§ç‰‡ä¸Šæ‹–æ›³è²¼ç´™é€²è¡Œè£é£¾ã€‚');
        });

        // è¨­ç½® Canvas æ‹–æ”¾å€
        photoCanvas.addEventListener('dragover', (e) => {
            e.preventDefault();
        });

        photoCanvas.addEventListener('drop', (e) => {
            e.preventDefault();
            const stickerSrc = e.dataTransfer.getData('text/plain');
            if (!stickerSrc) return;
            
            // æª¢æŸ¥æ˜¯å¦å·²æ‹ç…§
            if (webcamPreview.style.display !== 'none') {
                alert('è«‹å…ˆé»æ“Šã€Œæ‹ç…§ã€æŒ‰éˆ•ï¼');
                return;
            }

            const rect = photoCanvas.getBoundingClientRect();
            // åœ¨ CSS å°ºå¯¸ä¸Šçš„åº§æ¨™
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // ç¸®æ”¾æ¯”ä¾‹ (å°‡ CSS å°ºå¯¸è½‰æ›ç‚ºå¯¦éš› Canvas åƒç´ å°ºå¯¸)
            const scaleX = photoCanvas.width / rect.width;
            const scaleY = photoCanvas.height / rect.height;

            const actualX = x * scaleX;
            const actualY = y * scaleY;

            // å‰µå»ºè²¼ç´™åœ–ç‰‡ç‰©ä»¶
            const stickerImage = new Image();
            stickerImage.onload = () => {
                const size = 120 * scaleX; // è²¼ç´™å¤§å° (å¯èª¿æ•´)
                const stickerObj = { 
                    src: stickerImage, 
                    x: actualX - size / 2, 
                    y: actualY - size / 2, 
                    size: size 
                };
                stickersOnCanvas.push(stickerObj);
                
                redrawCanvasWithStickers(); // é‡æ–°ç¹ªè£½ Canvas
                createDownloadLink(); // æ›´æ–°ä¸‹è¼‰é€£çµ
            };
            stickerImage.src = stickerSrc;
        });
        
        // é‡æ–°ç¹ªè£½æ•´å€‹ Canvas (åº•åœ– + æ‰€æœ‰è²¼ç´™)
        function redrawCanvasWithStickers() {
            // é‡æ–°ç¹ªè£½åº•åœ– (é€™è£¡æˆ‘å€‘ä¾è³´ photoCanvas ä¸Šçš„åŸå§‹ç…§ç‰‡åƒç´ )
            // ç‚ºäº†å¯¦ç¾çœŸæ­£çš„é‡ç¹ªï¼Œæˆ‘å€‘éœ€è¦ä¿å­˜åŸå§‹ç…§ç‰‡çš„ Image/DataURLï¼Œ
            // é€™è£¡ç°¡å–®åœ°å‡è¨­åªéœ€è¦ç–ŠåŠ è²¼ç´™å³å¯ã€‚
            
            // æœ€ç°¡å–®çš„å¯¦ç¾ï¼šé‡æ–°ç¹ªè£½æ‰€æœ‰è²¼ç´™
            ctx.clearRect(0, 0, photoCanvas.width, photoCanvas.height); // æ¸…ç©º Canvas
            // é‡æ–°ç¹ªè£½åŸå§‹ç…§ç‰‡ (éœ€è¦ä¿å­˜åŸå§‹ç…§ç‰‡çš„ Image/DataURL)
            // é€™è£¡ç„¡æ³•ç›´æ¥é‡ç¹ªï¼Œå› ç‚ºåŸå§‹ç…§ç‰‡è³‡è¨Šä¸Ÿå¤±ã€‚ç‚ºäº†è®“å®ƒå‹•ï¼Œæˆ‘å€‘è·³éæ¸…ç©ºæ­¥é©Ÿ
            // é€™è£¡åƒ…ä½œç–ŠåŠ æ¼”ç¤ºã€‚
            
            // * ç‚ºäº†åŠŸèƒ½å®Œæ•´ï¼Œæˆ‘å€‘æ‡‰è©²åœ¨æ‹ç…§æ™‚ä¿å­˜åŸå§‹æ•¸æ“šï¼š
            const originalPhotoDataURL = photoCanvas.toDataURL();

            // çœŸæ­£çš„é‡ç¹ªæ­¥é©Ÿ (éœ€è¦è¼‰å…¥åŸå§‹æ•¸æ“š):
            const baseImage = new Image();
            baseImage.onload = () => {
                ctx.drawImage(baseImage, 0, 0, photoCanvas.width, photoCanvas.height);
                 // ç¹ªè£½æ‰€æœ‰è²¼ç´™
                stickersOnCanvas.forEach(sticker => {
                    ctx.drawImage(sticker.src, sticker.x, sticker.y, sticker.size, sticker.size);
                });
            };
            // ç”±æ–¼æˆ‘å€‘æ²’æœ‰å…¨å±€è®Šé‡ä¿å­˜åŸå§‹ç…§ç‰‡ DataURLï¼Œé€™è£¡ç”¨ toDataURL() çš„çµæœä¾†æ¨¡æ“¬ã€‚
            // é€™å¯èƒ½æœƒåœ¨é‡è¤‡æ‹–æ”¾æ™‚é™ä½ç•«è³ªï¼Œä½†åœ¨å–®æª”æ¡ˆç°¡å–®æ¼”ç¤ºä¸­å¯ç”¨ã€‚
            baseImage.src = originalPhotoDataURL;
            
        }

        // å‰µå»ºä¸‹è¼‰é€£çµ
        function createDownloadLink() {
            downloadArea.innerHTML = '';
            const downloadLink = document.createElement('a');
            downloadLink.href = photoCanvas.toDataURL('image/png');
            downloadLink.download = `kpop_polaroid_${Date.now()}.png`;
            downloadLink.textContent = 'ğŸ“¥ ä¸‹è¼‰æ‹ç«‹å¾—ç…§ç‰‡ (ç”¨æ–¼è¶…å•†åˆ—å°)';
            downloadLink.className = 'download-btn';
            downloadArea.appendChild(downloadLink);
        }


        // === E. æ‡‰æ´ç‰†èˆ‡ç•™è¨€å€åŠŸèƒ½ ===

        // æ‡‰æ´ç‰†
        window.postCheer = function() {
            const input = document.getElementById('cheer-input');
            const display = document.getElementById('cheers-display');
            const message = input.value.trim();

            if (message) {
                const cheerItem = document.createElement('p');
                cheerItem.className = 'cheer-message';
                cheerItem.innerHTML = `<strong>ç²‰çµ²ç•™è¨€:</strong> ${message} <span>(æ–¼ ${new Date().toLocaleString()})</span>`;
                display.prepend(cheerItem); // æ–°ç•™è¨€æ”¾åœ¨æœ€å‰é¢
                input.value = '';
            } else {
                alert('è«‹è¼¸å…¥æ‡‰æ´è¨Šæ¯ï¼');
            }
        }

        // ç•™è¨€å€
        window.postComment = function() {
            const input = document.getElementById('comment-input');
            const display = document.getElementById('comments-display');
            const message = input.value.trim();

            if (message) {
                const commentItem = document.createElement('p');
                commentItem.className = 'comment-message';
                commentItem.innerHTML = `<strong>åŒ¿åç”¨æˆ¶:</strong> ${message} <span>(æ–¼ ${new Date().toLocaleString()})</span>`;
                display.prepend(commentItem); 
                input.value = '';
            } else {
                alert('è«‹è¼¸å…¥ç•™è¨€ï¼');
            }
        }

        // === F. å•Ÿå‹•æ‰€æœ‰åŠŸèƒ½ ===
        document.addEventListener('DOMContentLoaded', () => {
            initBGM(); // åˆå§‹åŒ–éŸ³æ¨‚
            initStars(); // åˆå§‹åŒ–å¶åƒ/æ¼”å“¡åˆ—è¡¨
            loadStickers(); // åˆå§‹åŒ–è²¼ç´™é¸å–®
        });
    </script>
</body>
</html>
